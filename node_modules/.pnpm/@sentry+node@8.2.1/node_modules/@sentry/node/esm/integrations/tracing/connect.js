import { isWrapped } from '@opentelemetry/core';
import { ConnectInstrumentation } from '@opentelemetry/instrumentation-connect';
import { defineIntegration, isEnabled, captureException } from '@sentry/core';
import { addOpenTelemetryInstrumentation } from '@sentry/opentelemetry';
import { consoleSandbox } from '@sentry/utils';

const _connectIntegration = (() => {
  return {
    name: 'Connect',
    setupOnce() {
      addOpenTelemetryInstrumentation(new ConnectInstrumentation({}));
    },
  };
}) ;

const connectIntegration = defineIntegration(_connectIntegration);

// eslint-disable-next-line @typescript-eslint/no-explicit-any
function connectErrorMiddleware(err, req, res, next) {
  captureException(err);
  next(err);
}

const setupConnectErrorHandler = (app) => {
  app.use(connectErrorMiddleware);

  if (!isWrapped(app.use) && isEnabled()) {
    consoleSandbox(() => {
      // eslint-disable-next-line no-console
      console.warn(
        '[Sentry] Connect is not instrumented. This is likely because you required/imported connect before calling `Sentry.init()`.',
      );
    });
  }
};

export { connectIntegration, setupConnectErrorHandler };
//# sourceMappingURL=connect.js.map
